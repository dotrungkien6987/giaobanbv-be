# üìã K·∫æ HO·∫†CH REFACTOR H·ªÜ TH·ªêNG KPI - CHU K·ª≤ & ƒê·ªò KH√ì TH·ª∞C T·∫æ

**Ng√†y t·∫°o:** 17/10/2025  
**Ng∆∞·ªùi t·∫°o:** Development Team  
**M·ª•c ƒë√≠ch:** Refactor h·ªá th·ªëng KPI ƒë·ªÉ h·ªó tr·ª£ g√°n nhi·ªám v·ª• theo chu k·ª≥ v√† ƒë·ªô kh√≥ th·ª±c t·∫ø  
**Tr·∫°ng th√°i:** ‚úÖ APPROVED - Ready to implement

---

## üîß QUY·∫æT ƒê·ªäNH K·ª∏ THU·∫¨T (FINALIZED)

### ‚úÖ Decision 1: MucDoKho Data Type

- **Type:** `Number` v·ªõi 1 ch·ªØ s·ªë th·∫≠p ph√¢n
- **Range:** 1.0 - 10.0 (VD: 5.5, 7.2, 8.0)
- **Validation:** Math.round(v _ 10) === v _ 10
- **UI Input:** `<TextField type="number" step="0.1" min="1" max="10" />`

### ‚úÖ Decision 2: Default MucDoKho Strategy

- **Rule:** B·∫Øt bu·ªôc user nh·∫≠p manually khi g√°n nhi·ªám v·ª•
- **UI:** Pre-fill v·ªõi `NhiemVuThuongQuy.MucDoKhoDefault` (editable)
- **Backend:** Required field, kh√¥ng c√≥ default value t·ª± ƒë·ªông

### ‚úÖ Decision 3: API Architecture

- **Approach:** APIs ri√™ng bi·ªát (Option A - theo plan)
- **Endpoints:**
  - `POST /api/workmanagement/giao-nhiem-vu/gan-theo-chu-ky`
  - `POST /api/workmanagement/giao-nhiem-vu/copy-chu-ky`
  - `GET /api/workmanagement/giao-nhiem-vu/assignments` (with `?chuKyId` filter)
- **Reason:** Clear separation of concerns, easier to maintain

### ‚úÖ Decision 4: UI Strategy

- **Approach:** Thay th·∫ø form c≈© ho√†n to√†n
- **Implementation:** GanNhiemVuTheoChuKyDialog thay th·∫ø to√†n b·ªô flow c≈©
- **Backward Compatibility:** `ChuKyDanhGiaID: null` = g√°n vƒ©nh vi·ªÖn

### ‚úÖ Decision 5: Index Migration

- **Action:** Drop old unique index `{ NhanVienID, NhiemVuThuongQuyID }`
- **New Index:** Composite `{ NhanVienID, NhiemVuThuongQuyID, ChuKyDanhGiaID }` with partialFilterExpression
- **Manual Step:** `db.nhanviennhiemvu.dropIndex("NhanVienID_1_NhiemVuThuongQuyID_1")`

---

## üéØ T·ªîNG QUAN

### V·∫•n ƒë·ªÅ hi·ªán t·∫°i:

1. **G√°n nhi·ªám v·ª• vƒ©nh vi·ªÖn** ‚Üí Kh√¥ng linh ho·∫°t khi nhi·ªám v·ª• thay ƒë·ªïi theo th√°ng/qu√Ω
2. **ƒê·ªô kh√≥ c·ªë ƒë·ªãnh** t·ª´ template ‚Üí Kh√¥ng ph·∫£n √°nh nƒÉng l·ª±c th·ª±c t·∫ø c·ªßa t·ª´ng nh√¢n vi√™n
3. **Rebuild logic** m·ªói l·∫ßn fetch ‚Üí M·∫•t d·ªØ li·ªáu ƒëi·ªÉm ƒë√£ ch·∫•m

### Gi·∫£i ph√°p:

1. Th√™m `ChuKyDanhGiaID` v√†o `NhanVienNhiemVu` (g√°n theo chu k·ª≥)
2. Th√™m `MucDoKho` (actual) v√†o `NhanVienNhiemVu` (ƒë·ªô kh√≥ th·ª±c t·∫ø)
3. Rename `NhiemVuThuongQuy.MucDoKho` ‚Üí `MucDoKhoDefault` (ch·ªâ tham kh·∫£o)
4. Fix logic `getChamDiemDetail` (differential sync, kh√¥ng rebuild)

---

## üìä PH·∫†M VI THAY ƒê·ªîI

### Backend:

- **3 Models:** NhiemVuThuongQuy, NhanVienNhiemVu, DanhGiaNhiemVuThuongQuy
- **2 Controllers:** assignment.controller.js, kpi.controller.js
- **5 APIs m·ªõi:** ganNhiemVuTheoChuKy, copyChuKy, layDanhSachTheoChuKy, etc.

### Frontend:

- **2 Dialogs m·ªõi:** GanNhiemVuTheoChuKyDialog, CopyChuKyDialog
- **2 Redux slices:** giaoNhiemVuSlice, kpiSlice
- **3 Components update:** NhiemVuThuongQuyForm, ChamDiemKPIDialog, NhiemVuTable

### Database:

- **0 Migration scripts** (assume no existing KPI data)
- **2 New indexes:** Composite unique index on NhanVienNhiemVu

---

## üóÇÔ∏è CHI TI·∫æT T·ª™NG MODULE

---

## MODULE 1: Model `NhiemVuThuongQuy`

### üìç File: `modules/workmanagement/models/NhiemVuThuongQuy.js`

### Hi·ªán t·∫°i:

```javascript
const schema = new Schema({
  TenNhiemVu: { type: String, required: true },
  MoTa: String,
  MucDoKho: { type: Number, default: 5 }, // ‚Üê D√πng ƒë·ªÉ ch·∫•m ƒëi·ªÉm (SAI)
  TrangThaiHoatDong: { type: Boolean, default: true },
  isDeleted: { type: Boolean, default: false },
});
```

### C·∫ßn s·ª≠a:

```javascript
const schema = new Schema({
  TenNhiemVu: { type: String, required: true },
  MoTa: String,
  MucDoKhoDefault: {
    type: Number,
    default: 5.0,
    min: 1.0,
    max: 10.0,
    validate: {
      validator: (v) => Math.round(v * 10) === v * 10,
      message: "ƒê·ªô kh√≥ cho ph√©p t·ªëi ƒëa 1 ch·ªØ s·ªë th·∫≠p ph√¢n (VD: 5.5)",
    },
    description: "ƒê·ªô kh√≥ m·∫∑c ƒë·ªãnh (tham kh·∫£o), cho ph√©p 1 ch·ªØ s·ªë th·∫≠p ph√¢n",
  }, // ‚úÖ Rename: ch·ªâ tham kh·∫£o
  TrangThaiHoatDong: { type: Boolean, default: true },
  isDeleted: { type: Boolean, default: false },
});
```

### Impact:

- ‚úÖ **Low:** Ch·ªâ ƒë·ªïi t√™n field
- ‚ö†Ô∏è **Breaking Change:** T·∫•t c·∫£ API/UI ƒëang d√πng `MucDoKho` ph·∫£i ƒë·ªïi th√†nh `MucDoKhoDefault`

### Files ·∫£nh h∆∞·ªüng:

**Backend:**

- `modules/workmanagement/controllers/nhiemvu.controller.js` (CRUD)
- `modules/workmanagement/controllers/kpi.controller.js` (getChamDiemDetail - line 950)

**Frontend:**

- `src/features/NhiemVuThuongQuy/NhiemVuThuongQuyForm.js`
- `src/features/NhiemVuThuongQuy/NhiemVuThuongQuyTable.js`
- `src/features/NhiemVuThuongQuy/nhiemVuSlice.js`

### Test cases:

- [ ] CRUD nhi·ªám v·ª• th∆∞·ªùng quy hi·ªÉn th·ªã ƒë√∫ng label "ƒê·ªô kh√≥ m·∫∑c ƒë·ªãnh (tham kh·∫£o)"
- [ ] API tr·∫£ v·ªÅ `MucDoKhoDefault` thay v√¨ `MucDoKho`
- [ ] Frontend hi·ªÉn th·ªã tooltip gi·∫£i th√≠ch √Ω nghƒ©a

---

## MODULE 2: Model `NhanVienNhiemVu`

### üìç File: `modules/workmanagement/models/NhanVienNhiemVu.js`

### Hi·ªán t·∫°i:

```javascript
const schema = new Schema({
  NhanVienID: { type: ObjectId, ref: "NhanVien", required: true },
  NhiemVuThuongQuyID: {
    type: ObjectId,
    ref: "NhiemVuThuongQuy",
    required: true,
  },
  TrangThaiHoatDong: { type: Boolean, default: true },
  NgayGan: { type: Date, default: Date.now },
  NguoiGanID: { type: ObjectId, ref: "NhanVien" },
  isDeleted: { type: Boolean, default: false },
});

// Index
schema.index({ NhanVienID: 1, NhiemVuThuongQuyID: 1 });
```

**V·∫•n ƒë·ªÅ:**

- ‚ùå Kh√¥ng c√≥ `ChuKyDanhGiaID` ‚Üí Kh√¥ng g√°n theo chu k·ª≥
- ‚ùå Kh√¥ng c√≥ `MucDoKho` ‚Üí Kh√¥ng l∆∞u ƒë·ªô kh√≥ th·ª±c t·∫ø
- ‚ùå Index kh√¥ng ƒë·ªß ‚Üí C√≥ th·ªÉ duplicate khi g√°n l·∫°i cho nhi·ªÅu chu k·ª≥

### C·∫ßn s·ª≠a:

```javascript
const schema = new Schema(
  {
    NhanVienID: {
      type: ObjectId,
      ref: "NhanVien",
      required: true,
      index: true,
    },
    NhiemVuThuongQuyID: {
      type: ObjectId,
      ref: "NhiemVuThuongQuy",
      required: true,
      index: true,
    },

    // ‚úÖ NEW: G√°n theo chu k·ª≥ (null = vƒ©nh vi·ªÖn, backward compatible)
    ChuKyDanhGiaID: {
      type: ObjectId,
      ref: "ChuKyDanhGia",
      default: null,
      index: true,
    },

    // ‚úÖ NEW: ƒê·ªô kh√≥ th·ª±c t·∫ø (d√πng ƒë·ªÉ ch·∫•m ƒëi·ªÉm) - B·∫ÆT BU·ªòC USER NH·∫¨P
    MucDoKho: {
      type: Number,
      required: true,
      min: 1.0,
      max: 10.0,
      validate: {
        validator: (v) => Math.round(v * 10) === v * 10,
        message:
          "MucDoKho ph·∫£i l√† s·ªë t·ª´ 1.0-10.0 v·ªõi t·ªëi ƒëa 1 ch·ªØ s·ªë th·∫≠p ph√¢n (VD: 5.5, 7.2)",
      },
      description:
        "ƒê·ªô kh√≥ th·ª±c t·∫ø cho nh√¢n vi√™n n√†y (user nh·∫≠p manually khi g√°n)",
    },

    TrangThaiHoatDong: { type: Boolean, default: true },
    NgayGan: { type: Date, default: Date.now },
    NguoiGanID: { type: ObjectId, ref: "NhanVien" },
    isDeleted: { type: Boolean, default: false },
  },
  { timestamps: true }
);

// ‚úÖ NEW: Composite unique index
// M·ªôt nhi·ªám v·ª• ch·ªâ ƒë∆∞·ª£c g√°n 1 l·∫ßn cho 1 nh√¢n vi√™n trong 1 chu k·ª≥
schema.index(
  { NhanVienID: 1, NhiemVuThuongQuyID: 1, ChuKyDanhGiaID: 1 },
  {
    unique: true,
    partialFilterExpression: { isDeleted: { $ne: true } },
    name: "unique_assignment_per_cycle",
  }
);

// ‚úÖ NON-UNIQUE index for query performance (backward compatible)
// NOTE: Old unique index { NhanVienID: 1, NhiemVuThuongQuyID: 1, unique: true } ph·∫£i DROP
schema.index({ NhanVienID: 1, NhiemVuThuongQuyID: 1 });
```

**‚ö†Ô∏è MANUAL DB STEP REQUIRED:**

```javascript
// Run in MongoDB shell or Compass:
db.nhanviennhiemvu.dropIndex("NhanVienID_1_NhiemVuThuongQuyID_1");
// Sau ƒë√≥ restart server ƒë·ªÉ Mongoose t·∫°o indexes m·ªõi
```

### Impact:

- üî¥ **High:** Core model thay ƒë·ªïi ‚Üí ·∫¢nh h∆∞·ªüng to√†n b·ªô lu·ªìng g√°n & ch·∫•m KPI
- ‚úÖ **Backward Compatible:** `ChuKyDanhGiaID: null` = g√°n vƒ©nh vi·ªÖn (old behavior)

### Logic nghi·ªáp v·ª•:

```javascript
// G√°n vƒ©nh vi·ªÖn (backward compatible)
{
  NhanVienID: "nv-001",
  NhiemVuThuongQuyID: "nv-baocao",
  ChuKyDanhGiaID: null,        // ‚Üê Null = permanent
  MucDoKho: 5                  // ‚Üê Actual difficulty
}

// G√°n cho Q1/2025
{
  NhanVienID: "nv-001",
  NhiemVuThuongQuyID: "nv-kpi",
  ChuKyDanhGiaID: "q1-2025",   // ‚Üê For Q1 only
  MucDoKho: 7                  // ‚Üê Adjusted for this employee
}

// ‚úÖ Unique constraint prevents duplicate:
// - Kh√¥ng th·ªÉ g√°n "nv-kpi" cho "nv-001" trong Q1 2 l·∫ßn
// - Nh∆∞ng c√≥ th·ªÉ g√°n cho Q2 (kh√°c ChuKyDanhGiaID)
```

### Files ·∫£nh h∆∞·ªüng:

**Backend:**

- `modules/workmanagement/controllers/assignment.controller.js` (to√†n b·ªô CRUD)
- `modules/workmanagement/controllers/kpi.controller.js` (getChamDiemDetail - line 900+)

**Frontend:**

- `src/features/GiaoNhiemVu/` (to√†n b·ªô folder c·∫ßn rebuild)

### Test cases:

- [ ] G√°n vƒ©nh vi·ªÖn (`ChuKyDanhGiaID: null`) v·∫´n ho·∫°t ƒë·ªông
- [ ] G√°n cho Q1 ‚Üí G√°n l·∫°i cho Q1 ‚Üí Error duplicate
- [ ] G√°n cho Q1 ‚Üí G√°n cho Q2 ‚Üí OK (kh√°c chu k·ª≥)
- [ ] `MucDoKho` = 5.5 ‚Üí OK (decimal allowed)
- [ ] `MucDoKho` = 5.55 ‚Üí Error (qu√° 1 ch·ªØ s·ªë th·∫≠p ph√¢n)
- [ ] `MucDoKho` = 11 ‚Üí Error (v∆∞·ª£t max)
- [ ] G√°n kh√¥ng nh·∫≠p `MucDoKho` ‚Üí Error (required field)
- [ ] Soft delete (`isDeleted: true`) kh√¥ng vi ph·∫°m unique constraint

---

## MODULE 3: Backend API - Giao Nhi·ªám V·ª•

### üìç Files:

- `modules/workmanagement/controllers/giaoNhiemVu.controller.js` (NEW controller)
- `modules/workmanagement/services/giaoNhiemVu.service.js` (NEW service)
- `modules/workmanagement/routes/giaoNhiemVu.api.js` (UPDATE routes)

### Strategy:

- ‚úÖ **THAY TH·∫æ** flow c≈© ho√†n to√†n
- ‚úÖ T·∫•t c·∫£ APIs m·ªõi ƒë·ªÅu y√™u c·∫ßu `MucDoKho` (user nh·∫≠p manually)
- ‚úÖ `ChuKyDanhGiaID` nullable (null = g√°n vƒ©nh vi·ªÖn)

### Hi·ªán t·∫°i (s·∫Ω DEPRECATED):

```javascript
// ‚ùå OLD: POST /api/workmanagement/giao-nhiem-vu/assignments
// Kh√¥ng support ChuKyDanhGiaID, kh√¥ng c√≥ MucDoKho
ctrl.assignOne = catchAsync(async (req, res) => {
  const { NhanVienID, NhiemVuThuongQuyID } = req.body;
  // T·∫°o assignment kh√¥ng c√≥ MucDoKho, kh√¥ng c√≥ ChuKyDanhGiaID
});
```

### C·∫ßn th√™m m·ªõi:

#### **API 1: G√°n nhi·ªám v·ª• theo chu k·ª≥ (THAY TH·∫æ assignOne)**

```javascript
/**
 * @route POST /api/workmanagement/giao-nhiem-vu/gan-theo-chu-ky
 * @desc G√°n nhi·ªám v·ª• cho nh√¢n vi√™n theo chu k·ª≥ (ho·∫∑c vƒ©nh vi·ªÖn)
 * @body {
 *   ChuKyDanhGiaID: String | null,  // null = permanent
 *   NhanVienID: String,
 *   assignments: [
 *     {
 *       NhiemVuThuongQuyID: String,
 *       MucDoKho: Number  // ‚úÖ REQUIRED - user nh·∫≠p manually
 *     }
 *   ]
 * }
 * @access Private (Manager with QuanLyNhanVien permission)
 */
service.ganNhiemVuTheoChuKy = async (req, data) => {
  // 1. Permission check
  // 2. Validate MucDoKho (1.0-10.0, 1 decimal)
  // 3. Upsert NhanVienNhiemVu v·ªõi ChuKyDanhGiaID + MucDoKho
  // 4. Return created/updated assignments
};
```

#### **API 2: Copy nhi·ªám v·ª• gi·ªØa c√°c chu k·ª≥**

```javascript
/**
 * @route POST /api/workmanagement/giao-nhiem-vu/copy-chu-ky
 * @desc Copy nhi·ªám v·ª• t·ª´ chu k·ª≥ c≈© sang chu k·ª≥ m·ªõi (bao g·ªìm MucDoKho)
 * @body {
 *   NhanVienID: String,
 *   FromChuKyID: String,
 *   ToChuKyID: String,
 *   adjustMucDoKho: Boolean  // ‚úÖ NEW: Cho ph√©p ƒëi·ªÅu ch·ªânh ƒë·ªô kh√≥ sau khi copy
 * }
 * @access Private (Manager)
 */
service.copyChuKy = async (req, data) => {
  // 1. Permission check
  // 2. Load assignments from FromChuKyID
  // 3. Create new assignments for ToChuKyID (copy MucDoKho)
  // 4. Return { copiedCount, assignments }
};
```

#### **API 3: L·∫•y danh s√°ch theo chu k·ª≥ (UPDATE existing)**

```javascript
/**
 * @route GET /api/workmanagement/giao-nhiem-vu/assignments
 * @query NhanVienID (required), chuKyId (optional)
 * @desc L·∫•y danh s√°ch nhi·ªám v·ª• ƒë√£ g√°n (filter theo chu k·ª≥)
 * @access Private
 */
service.getAssignmentsByEmployee = async (req, NhanVienID) => {
  const { chuKyId } = req.query;
  const query = {
    NhanVienID,
    isDeleted: false,
    TrangThaiHoatDong: true,
  };

  if (chuKyId) {
    query.$or = [
      { ChuKyDanhGiaID: chuKyId },
      { ChuKyDanhGiaID: null }, // ‚úÖ Include permanent assignments
    ];
  }

  return await NhanVienNhiemVu.find(query)
    .populate("NhiemVuThuongQuyID") // ‚Üê Include MucDoKhoDefault
    .populate("NguoiGanID")
    .sort({ NgayGan: -1 });
};
```

#### **API 4: C·∫≠p nh·∫≠t ƒë·ªô kh√≥ (OPTIONAL - c√≥ th·ªÉ skip)**

```javascript
/**
 * @route PUT /api/workmanagement/giao-nhiem-vu/assignments/:id/muc-do-kho
 * @desc C·∫≠p nh·∫≠t ƒë·ªô kh√≥ th·ª±c t·∫ø cho assignment (sau khi ƒë√£ g√°n)
 * @body { MucDoKho: Number }
 * @access Private (Manager)
 *
 * NOTE: C√≥ th·ªÉ skip API n√†y - user c√≥ th·ªÉ g·ª° g√°n r·ªìi g√°n l·∫°i v·ªõi ƒë·ªô kh√≥ m·ªõi
 */
service.capNhatMucDoKho = async (req, assignmentId, MucDoKho) => {
  // 1. Permission check
  // 2. Validate MucDoKho
  // 3. Update NhanVienNhiemVu
  // 4. Return updated assignment
};
```

### Routes c·∫ßn th√™m:

```javascript
// File: modules/workmanagement/routes/giaoNhiemVu.api.js

// ‚úÖ NEW: G√°n theo chu k·ª≥ (thay th·∫ø POST /assignments)
router.post(
  "/gan-theo-chu-ky",
  authentication.loginRequired,
  validators.validate(validators.ganTheoChuKySchema),
  ctrl.ganNhiemVuTheoChuKy
);

// ‚úÖ NEW: Copy chu k·ª≥
router.post(
  "/copy-chu-ky",
  authentication.loginRequired,
  validators.validate(validators.copyChuKySchema),
  ctrl.copyChuKy
);

// ‚úÖ KEEP: L·∫•y danh s√°ch (ƒë√£ c√≥, ch·ªâ c·∫ßn th√™m chuKyId query)
router.get(
  "/assignments",
  authentication.loginRequired,
  ctrl.getAssignmentsByEmployee // Existing, supports ?chuKyId
);

// ‚úÖ OPTIONAL: Update ƒë·ªô kh√≥
router.put(
  "/assignments/:assignmentId/muc-do-kho",
  authentication.loginRequired,
  validators.validate(validators.updateMucDoKhoSchema),
  ctrl.capNhatMucDoKho
);

// ‚úÖ DEPRECATE: POST /assignments (old assignOne - kh√¥ng d√πng n·ªØa)
// router.post("/assignments", ctrl.assignOne);  // ‚Üê Comment out
```

### Validators c·∫ßn th√™m:

```javascript
// File: modules/workmanagement/validators/giaoNhiemVu.validator.js (NEW file)

const Joi = require("joi");

const validators = {};

// ‚úÖ Validator cho ƒë·ªô kh√≥ (cho ph√©p 1 ch·ªØ s·ªë th·∫≠p ph√¢n)
const mucDoKhoValidator = Joi.number()
  .min(1.0)
  .max(10.0)
  .custom((value, helpers) => {
    // Check 1 decimal place
    if (Math.round(value * 10) !== value * 10) {
      return helpers.error("any.invalid");
    }
    return value;
  })
  .required()
  .messages({
    "number.min": "ƒê·ªô kh√≥ ph·∫£i >= 1.0",
    "number.max": "ƒê·ªô kh√≥ ph·∫£i <= 10.0",
    "any.invalid": "ƒê·ªô kh√≥ cho ph√©p t·ªëi ƒëa 1 ch·ªØ s·ªë th·∫≠p ph√¢n (VD: 5.5, 7.2)",
    "any.required": "ƒê·ªô kh√≥ l√† b·∫Øt bu·ªôc - vui l√≤ng nh·∫≠p th·ªß c√¥ng",
  });

validators.ganTheoChuKySchema = Joi.object({
  ChuKyDanhGiaID: Joi.string().allow(null).optional(),
  NhanVienID: Joi.string().required(),
  assignments: Joi.array()
    .items(
      Joi.object({
        NhiemVuThuongQuyID: Joi.string().required(),
        MucDoKho: mucDoKhoValidator, // ‚úÖ REQUIRED - user nh·∫≠p
      })
    )
    .min(1)
    .required(),
});

validators.copyChuKySchema = Joi.object({
  NhanVienID: Joi.string().required(),
  FromChuKyID: Joi.string().required(),
  ToChuKyID: Joi.string().required(),
  adjustMucDoKho: Joi.boolean().optional().default(false),
});

validators.updateMucDoKhoSchema = Joi.object({
  MucDoKho: mucDoKhoValidator,
});

module.exports = validators;
```

      })
    )
    .min(1)
    .required(),

});

validators.copyChuKySchema = Joi.object({
NhanVienID: Joi.string().required(),
FromChuKyID: Joi.string().required(),
ToChuKyID: Joi.string().required(),
});

validators.updateMucDoKhoSchema = Joi.object({
MucDoKho: Joi.number().integer().min(1).max(10).required(),
});

````

### Test cases:

- [ ] G√°n nhi·ªám v·ª• cho Q1 ‚Üí 200 OK
- [ ] G√°n l·∫°i nhi·ªám v·ª• cho Q1 ‚Üí 200 OK (upsert)
- [ ] G√°n nhi·ªám v·ª• kh√¥ng c√≥ quy·ªÅn ‚Üí 403 Forbidden
- [ ] Copy t·ª´ Q1 ‚Üí Q2 ‚Üí 200 OK, `copiedCount` ƒë√∫ng
- [ ] Copy t·ª´ chu k·ª≥ kh√¥ng c√≥ nhi·ªám v·ª• ‚Üí 404 Not Found
- [ ] C·∫≠p nh·∫≠t ƒë·ªô kh√≥ = 11 ‚Üí 400 Bad Request (validation)
- [ ] L·∫•y danh s√°ch theo Q1 ‚Üí Bao g·ªìm c·∫£ permanent

---

## MODULE 4: Backend API - Ch·∫•m KPI

### üìç File: `modules/workmanagement/controllers/kpi.controller.js`

### Hi·ªán t·∫°i (Line 900-950):

```javascript
kpiController.getChamDiemDetail = catchAsync(async (req, res) => {
  // ... upsert DanhGiaKPI ...

  // ‚ùå BUG: Kh√¥ng filter theo ChuKyDanhGiaID
  const raw = await NhanVienNhiemVu.find({
    NhanVienID: nhanVienId,
    isDeleted: { $ne: true },
  }).populate('NhiemVuThuongQuyID');

  // ... differential sync ...

  // ‚ùå BUG: D√πng MucDoKho t·ª´ template
  const payloads = toAdd.map((nvItem) => ({
    MucDoKho: nvItem.NhiemVuThuongQuyID.MucDoKho,  // ‚Üê SAI
  }));

  // ‚ùå BUG: Update MucDoKho t·ª´ template m·ªói l·∫ßn fetch
  if (exist.MucDoKho !== a.NhiemVuThuongQuyID.MucDoKho) {
    await DanhGiaNhiemVuThuongQuy.updateOne(...);
  }
});
````

### C·∫ßn s·ª≠a (Line 900-950):

```javascript
kpiController.getChamDiemDetail = catchAsync(async (req, res) => {
  const { chuKyId, nhanVienId } = req.query;

  // ... upsert DanhGiaKPI ...

  // ‚úÖ FIX: Filter by ChuKyDanhGiaID
  const raw = await NhanVienNhiemVu.find({
    NhanVienID: nhanVienId,
    $or: [
      { ChuKyDanhGiaID: chuKyId },      // ‚Üê Chu k·ª≥ n√†y
      { ChuKyDanhGiaID: null }          // ‚Üê Vƒ©nh vi·ªÖn
    ],
    isDeleted: { $ne: true },
  })
    .populate({
      path: 'NhiemVuThuongQuyID',
      select: 'TenNhiemVu MoTa MucDoKhoDefault'  // ‚Üê ƒê·ªïi t√™n field
    })
    .lean();

  // ... differential sync (keep unchanged) ...

  // ‚úÖ FIX: Use actual MucDoKho from NhanVienNhiemVu
  const payloads = toAdd.map((nvItem) => ({
    DanhGiaKPIID: danhGiaKPI._id,
    NhiemVuThuongQuyID: nvItem.NhiemVuThuongQuyID._id,
    NhanVienID: nhanVienId,
    MucDoKho: nvItem.MucDoKho,  // ‚úÖ Use actual (from NhanVienNhiemVu)
    ChiTietDiem: tieuChiList.map(...),
  }));

  // ‚úÖ REMOVE: Logic update MucDoKho t·ª´ template (kh√¥ng c·∫ßn n·ªØa)
  // await Promise.all(
  //   assignments.map(async (a) => {
  //     const exist = existingMap.get(...);
  //     if (exist && exist.MucDoKho !== a.NhiemVuThuongQuyID.MucDoKho) {
  //       await DanhGiaNhiemVuThuongQuy.updateOne(...);
  //     }
  //   })
  // );
});
```

### Logic flow m·ªõi:

```
1. User m·ªü form ch·∫•m KPI (Q1/2025, NV-A)
   ‚Üì
2. Backend query NhanVienNhiemVu:
   - WHERE NhanVienID = NV-A
   - AND (ChuKyDanhGiaID = Q1 OR ChuKyDanhGiaID IS NULL)
   ‚Üì
3. Result: [
     { NhiemVuID: "nv-baocao", MucDoKho: 5, ChuKyDanhGiaID: null },      // Permanent
     { NhiemVuID: "nv-kpi", MucDoKho: 7, ChuKyDanhGiaID: "q1-2025" }     // Q1 only
   ]
   ‚Üì
4. Differential sync:
   - N·∫øu DanhGiaNhiemVuThuongQuy ch∆∞a c√≥ "nv-kpi" ‚Üí T·∫°o m·ªõi v·ªõi MucDoKho = 7
   - N·∫øu ƒë√£ c√≥ ‚Üí GI·ªÆ NGUY√äN (kh√¥ng rebuild, kh√¥ng m·∫•t ƒëi·ªÉm)
   ‚Üì
5. Return nhiemVuList (2 nhi·ªám v·ª•) v·ªõi MucDoKho th·ª±c t·∫ø
```

### Test cases:

- [ ] Fetch ch·∫•m ƒëi·ªÉm Q1 ‚Üí Bao g·ªìm nhi·ªám v·ª• Q1 + permanent
- [ ] Fetch ch·∫•m ƒëi·ªÉm Q2 ‚Üí Ch·ªâ nhi·ªám v·ª• Q2 + permanent (kh√¥ng c√≥ Q1)
- [ ] MucDoKho hi·ªÉn th·ªã = actual (t·ª´ NhanVienNhiemVu), kh√¥ng ph·∫£i template
- [ ] G√°n th√™m nhi·ªám v·ª• m·ªõi ‚Üí Auto-sync (kh√¥ng m·∫•t ƒëi·ªÉm c≈©)
- [ ] X√≥a nhi·ªám v·ª• kh·ªèi assignment ‚Üí Soft delete (kh√¥ng m·∫•t l·ªãch s·ª≠)

---

## MODULE 5: Frontend - Giao Nhi·ªám V·ª•

### üìç Folder: `src/features/GiaoNhiemVu/`

### Hi·ªán t·∫°i:

```
GiaoNhiemVu/
  GiaoNhiemVuForm.js       // Simple form: Ch·ªçn NV + nhi·ªám v·ª•
  GiaoNhiemVuTable.js      // List assignments
  giaoNhiemVuSlice.js      // Redux: ganNhiemVu, xoaNhiemVu
```

**V·∫•n ƒë·ªÅ:**

- ‚ùå Kh√¥ng ch·ªçn chu k·ª≥
- ‚ùå Kh√¥ng set ƒë·ªô kh√≥ th·ª±c t·∫ø
- ‚ùå Kh√¥ng c√≥ ch·ª©c nƒÉng copy

### C·∫ßn x√¢y d·ª±ng m·ªõi:

```
GiaoNhiemVu/
  GanNhiemVuTheoChuKyDialog.js     // ‚úÖ NEW: Main dialog
    - Ch·ªçn chu k·ª≥ (nullable)
    - Table nhi·ªám v·ª• + checkbox + ƒë·ªô kh√≥
    - Button "Copy t·ª´ chu k·ª≥ tr∆∞·ªõc"

  CopyChuKyDialog.js                // ‚úÖ NEW: Copy dialog
    - Ch·ªçn chu k·ª≥ ngu·ªìn
    - Ch·ªçn chu k·ª≥ ƒë√≠ch
    - Preview nhi·ªám v·ª• s·∫Ω copy

  DanhSachNhiemVuTable.js           // ‚úÖ UPDATE: Add columns
    - Column "Chu k·ª≥" (badge: "Vƒ©nh vi·ªÖn" | "Q1/2025")
    - Column "ƒê·ªô kh√≥ th·ª±c t·∫ø"
    - Filter by chu k·ª≥

  giaoNhiemVuSlice.js               // ‚úÖ UPDATE: New actions
    - ganNhiemVuTheoChuKy()
    - copyChuKy()
    - layDanhSachTheoChuKy()
```

### Component m·ªõi: `GanNhiemVuTheoChuKyDialog.js`

```javascript
function GanNhiemVuTheoChuKyDialog({ open, onClose, nhanVien }) {
  const [chuKy, setChuKy] = useState(null); // null = permanent
  const [selected, setSelected] = useState([]); // [{ NhiemVuThuongQuyID, MucDoKho }]

  const handleSubmit = async () => {
    await dispatch(
      ganNhiemVuTheoChuKy({
        ChuKyDanhGiaID: chuKy?._id || null,
        NhanVienID: nhanVien._id,
        assignments: selected,
      })
    );
  };

  const handleCopy = () => {
    // Open CopyChuKyDialog
  };

  return (
    <Dialog maxWidth="md">
      <DialogTitle>G√°n nhi·ªám v·ª• cho {nhanVien.Ten}</DialogTitle>

      {/* Ch·ªçn chu k·ª≥ */}
      <Autocomplete
        value={chuKy}
        onChange={(e, val) => setChuKy(val)}
        options={chuKyList}
        label="Chu k·ª≥ ƒë√°nh gi√°"
        placeholder="ƒê·ªÉ tr·ªëng = G√°n vƒ©nh vi·ªÖn"
      />

      {/* Table nhi·ªám v·ª• */}
      <Table>
        <TableHead>
          <TableRow>
            <TableCell padding="checkbox">Ch·ªçn</TableCell>
            <TableCell>Nhi·ªám v·ª•</TableCell>
            <TableCell>ƒê·ªô kh√≥ m·∫∑c ƒë·ªãnh</TableCell>
            <TableCell>ƒê·ªô kh√≥ th·ª±c t·∫ø</TableCell>
          </TableRow>
        </TableHead>
        <TableBody>
          {nhiemVuList.map((nv) => (
            <TableRow key={nv._id}>
              <TableCell padding="checkbox">
                <Checkbox
                  checked={isSelected(nv._id)}
                  onChange={(e) => handleToggle(nv, e.target.checked)}
                />
              </TableCell>
              <TableCell>{nv.TenNhiemVu}</TableCell>
              <TableCell>{nv.MucDoKhoDefault}</TableCell>
              <TableCell>
                <TextField
                  type="number"
                  value={getMucDoKho(nv._id)}
                  onChange={(e) => handleChangeMucDoKho(nv._id, e.target.value)}
                  inputProps={{ min: 1, max: 10 }}
                  sx={{ width: 80 }}
                />
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>

      <DialogActions>
        <Button onClick={handleCopy}>Copy t·ª´ chu k·ª≥ tr∆∞·ªõc</Button>
        <Button onClick={onClose}>H·ªßy</Button>
        <Button variant="contained" onClick={handleSubmit}>
          G√°n nhi·ªám v·ª•
        </Button>
      </DialogActions>
    </Dialog>
  );
}
```

### Redux slice updates:

```javascript
// File: src/features/GiaoNhiemVu/giaoNhiemVuSlice.js

// ‚úÖ NEW Action
export const ganNhiemVuTheoChuKy = (data) => async (dispatch) => {
  dispatch(slice.actions.startLoading());
  try {
    const response = await apiService.post(
      "/workmanagement/assignments/gan-theo-chu-ky",
      data
    );
    dispatch(slice.actions.ganNhiemVuTheoChuKySuccess(response.data.data));
    toast.success("G√°n nhi·ªám v·ª• th√†nh c√¥ng");
  } catch (error) {
    dispatch(slice.actions.hasError(error.message));
    toast.error(error.message);
  }
};

// ‚úÖ NEW Action
export const copyChuKy = (data) => async (dispatch) => {
  dispatch(slice.actions.startLoading());
  try {
    const response = await apiService.post(
      "/workmanagement/assignments/copy-chu-ky",
      data
    );
    dispatch(slice.actions.copyChuKySuccess(response.data.data));
    toast.success(`ƒê√£ copy ${response.data.data.copiedCount} nhi·ªám v·ª•`);
  } catch (error) {
    dispatch(slice.actions.hasError(error.message));
    toast.error(error.message);
  }
};
```

### Test cases:

- [ ] M·ªü dialog ‚Üí Load danh s√°ch nhi·ªám v·ª• + chu k·ª≥
- [ ] Ch·ªçn nhi·ªám v·ª• ‚Üí Checkbox + text field ƒë·ªô kh√≥ ho·∫°t ƒë·ªông
- [ ] ƒê·ªÉ tr·ªëng chu k·ª≥ ‚Üí G√°n vƒ©nh vi·ªÖn (`ChuKyDanhGiaID: null`)
- [ ] Ch·ªçn Q1 + g√°n ‚Üí Success toast + reload table
- [ ] Click "Copy t·ª´ chu k·ª≥ tr∆∞·ªõc" ‚Üí M·ªü CopyChuKyDialog
- [ ] Validation ƒë·ªô kh√≥: < 1 ho·∫∑c > 10 ‚Üí Error

---

## MODULE 6: Frontend - Ch·∫•m KPI

### üìç File: `src/features/KPI/ChamDiemKPIDialog.js`

### Hi·ªán t·∫°i:

```javascript
<TableRow>
  <TableCell>{nhiemVu.NhiemVuThuongQuyID.TenNhiemVu}</TableCell>
  <TableCell>ƒê·ªô kh√≥: {nhiemVu.MucDoKho}</TableCell> // ‚Üê Hi·ªÉn th·ªã sai
  <TableCell>{/* Input ch·∫•m ƒëi·ªÉm */}</TableCell>
</TableRow>
```

**V·∫•n ƒë·ªÅ:**

- ‚ùå `nhiemVu.MucDoKho` l√† actual (ƒë√∫ng), nh∆∞ng kh√¥ng c√≥ tooltip gi·∫£i th√≠ch
- ‚ùå Kh√¥ng hi·ªÉn th·ªã ƒë·ªô kh√≥ m·∫∑c ƒë·ªãnh (reference)

### C·∫ßn s·ª≠a:

```javascript
<TableRow>
  <TableCell>
    <Typography variant="subtitle2">
      {nhiemVu.NhiemVuThuongQuyID.TenNhiemVu}
    </Typography>
  </TableCell>
  <TableCell>
    <Box display="flex" alignItems="center" gap={1}>
      <Typography>
        ƒê·ªô kh√≥: <strong>{nhiemVu.MucDoKho}</strong>
      </Typography>
      <Tooltip
        title={`ƒê·ªô kh√≥ m·∫∑c ƒë·ªãnh: ${nhiemVu.NhiemVuThuongQuyID.MucDoKhoDefault}`}
      >
        <InfoIcon fontSize="small" color="action" />
      </Tooltip>
    </Box>
  </TableCell>
  <TableCell>{/* Input ch·∫•m ƒëi·ªÉm */}</TableCell>
</TableRow>
```

### Redux slice:

```javascript
// File: src/features/KPI/kpiSlice.js

// ‚úÖ No changes needed - Backend already returns correct data
// - nhiemVu.MucDoKho = actual (from NhanVienNhiemVu)
// - nhiemVu.NhiemVuThuongQuyID.MucDoKhoDefault = template
```

### Test cases:

- [ ] M·ªü form ch·∫•m ƒëi·ªÉm ‚Üí Hi·ªÉn th·ªã ƒë·ªô kh√≥ th·ª±c t·∫ø (actual)
- [ ] Hover icon ‚ìò ‚Üí Tooltip hi·ªÉn th·ªã ƒë·ªô kh√≥ m·∫∑c ƒë·ªãnh
- [ ] ƒê·ªô kh√≥ = 7, m·∫∑c ƒë·ªãnh = 5 ‚Üí Hi·ªÉn th·ªã ƒë√∫ng c·∫£ 2
- [ ] Ch·∫•m ƒëi·ªÉm ‚Üí DiemNhiemVu = (MucDoKho √ó TongDiem) / 100 (d√πng actual)

---

## üìÖ TIMELINE IMPLEMENTATION

### **PHASE 1: Backend Foundation** (4-5 hours)

**Day 1 Morning (2h):**

- ‚úÖ Update `NhiemVuThuongQuy` model
  - Rename `MucDoKho` ‚Üí `MucDoKhoDefault`
  - Update indexes (if any)
- ‚úÖ Update `NhanVienNhiemVu` model
  - Add `ChuKyDanhGiaID` field (nullable, indexed)
  - Add `MucDoKho` field (required, 1-10)
  - Add composite unique index
- ‚úÖ Test models v·ªõi MongoDB Compass/Postman

**Day 1 Afternoon (2-3h):**

- ‚úÖ Create `ganNhiemVuTheoChuKy` API
- ‚úÖ Create `copyChuKy` API
- ‚úÖ Update `layDanhSachNhiemVu` API (filter by chu k·ª≥)
- ‚úÖ Create validators (Joi schemas)
- ‚úÖ Test APIs with Postman collection

---

### **PHASE 2: Backend Integration** (2-3 hours)

**Day 2 Morning (2-3h):**

- ‚úÖ Update `kpi.controller.js` ‚Üí `getChamDiemDetail`
  - Line 900+: Add filter `ChuKyDanhGiaID`
  - Line 950+: Use actual `MucDoKho` from `NhanVienNhiemVu`
  - Remove logic update `MucDoKho` from template
- ‚úÖ Update other controllers using `NhiemVuThuongQuy.MucDoKho`
  - Search: `grep -r "MucDoKho" modules/`
  - Replace with `MucDoKhoDefault`
- ‚úÖ Test end-to-end: G√°n ‚Üí Fetch ch·∫•m ƒëi·ªÉm ‚Üí Verify data

---

### **PHASE 3: Frontend - Giao Nhi·ªám V·ª•** (6-7 hours)

**Day 2 Afternoon (3h):**

- ‚úÖ Create `GanNhiemVuTheoChuKyDialog.js`
  - Layout: Autocomplete chu k·ª≥ + Table nhi·ªám v·ª•
  - State management: selected nhi·ªám v·ª• + ƒë·ªô kh√≥
  - Submit handler: Call API `ganNhiemVuTheoChuKy`
- ‚úÖ Create `CopyChuKyDialog.js`
  - Layout: 2 Autocomplete (from/to chu k·ª≥) + Preview list
  - Submit handler: Call API `copyChuKy`

**Day 3 Morning (3-4h):**

- ‚úÖ Update `giaoNhiemVuSlice.js`
  - Add `ganNhiemVuTheoChuKy` thunk
  - Add `copyChuKy` thunk
  - Add reducers: `ganNhiemVuTheoChuKySuccess`, `copyChuKySuccess`
- ‚úÖ Update `DanhSachNhiemVuTable.js`
  - Add column "Chu k·ª≥" (badge component)
  - Add column "ƒê·ªô kh√≥ th·ª±c t·∫ø"
  - Add filter dropdown (chu k·ª≥)
- ‚úÖ Integration: Replace old form with new dialog

---

### **PHASE 4: Frontend - Ch·∫•m KPI** (1 hour)

**Day 3 Afternoon (1h):**

- ‚úÖ Update `ChamDiemKPIDialog.js`
  - Display actual `MucDoKho` with bold style
  - Add tooltip for `MucDoKhoDefault`
  - Update column layout
- ‚úÖ Test: Verify ƒë·ªô kh√≥ hi·ªÉn th·ªã ƒë√∫ng

---

### **PHASE 5: Testing & Documentation** (2 hours)

**Day 4 (2h):**

- ‚úÖ E2E testing:
  1. G√°n vƒ©nh vi·ªÖn ‚Üí Fetch ch·∫•m ƒëi·ªÉm ‚Üí Verify
  2. G√°n theo Q1 ‚Üí Fetch Q1 ‚Üí Verify (kh√¥ng c√≥ Q2)
  3. Copy Q1 ‚Üí Q2 ‚Üí Verify copied
  4. Ch·∫•m ƒëi·ªÉm ‚Üí Duy·ªát ‚Üí Verify t√≠nh ƒëi·ªÉm ƒë√∫ng
- ‚úÖ Update API documentation (Swagger/Postman)
- ‚úÖ Update user guide (screenshots + workflow)
- ‚úÖ Code review + fix bugs
- ‚úÖ Deploy to staging

---

## ‚úÖ CHECKLIST T·ªîNG TH·ªÇ

### Backend:

- [ ] Update `NhiemVuThuongQuy` model (rename field)
- [ ] Update `NhanVienNhiemVu` model (add fields + index)
- [ ] Create `ganNhiemVuTheoChuKy` API
- [ ] Create `copyChuKy` API
- [ ] Create `capNhatMucDoKho` API
- [ ] Update `layDanhSachNhiemVu` API
- [ ] Update `getChamDiemDetail` controller
- [ ] Update all CRUD controllers using `MucDoKho`
- [ ] Create validators (Joi schemas)
- [ ] Test all endpoints

### Frontend:

- [ ] Create `GanNhiemVuTheoChuKyDialog` component
- [ ] Create `CopyChuKyDialog` component
- [ ] Update `giaoNhiemVuSlice` (add actions + reducers)
- [ ] Update `DanhSachNhiemVuTable` (add columns + filter)
- [ ] Update `ChamDiemKPIDialog` (display actual + tooltip)
- [ ] Update `NhiemVuThuongQuyForm` (label: "ƒê·ªô kh√≥ m·∫∑c ƒë·ªãnh")
- [ ] Test all UI flows

### Testing:

- [ ] Unit tests (backend APIs)
- [ ] Integration tests (E2E workflows)
- [ ] UI tests (form validation, data display)
- [ ] Edge cases (duplicate, permission, etc.)

### Documentation:

- [ ] API docs (Swagger/Postman collection)
- [ ] User guide (workflow + screenshots)
- [ ] Technical docs (this file updated)
- [ ] CHANGELOG.md

---

## üö® RISKS & MITIGATION

### Risk 1: Breaking existing KPI data

**Mitigation:**

- ‚úÖ Assume no existing data (per requirement)
- ‚úÖ If needed: Create migration script (set `ChuKyDanhGiaID: null` for old data)

### Risk 2: Unique constraint violation

**Mitigation:**

- ‚úÖ Use `partialFilterExpression: { isDeleted: { $ne: true } }`
- ‚úÖ Soft delete allows re-assignment after delete

### Risk 3: Frontend complexity

**Mitigation:**

- ‚úÖ Ph√¢n chia components nh·ªè (dialog, table, form ri√™ng)
- ‚úÖ Reuse existing form components (`FAutocomplete`, `FTextField`)
- ‚úÖ Clear state management (Redux slice per feature)

### Risk 4: Performance (nhi·ªÅu queries)

**Mitigation:**

- ‚úÖ Use composite index: `{ NhanVienID, ChuKyDanhGiaID }`
- ‚úÖ Use `.lean()` for read-only queries
- ‚úÖ Pagination for large lists

---

## üìù NOTES

### Backward Compatibility:

- ‚úÖ `ChuKyDanhGiaID: null` = g√°n vƒ©nh vi·ªÖn (old behavior)
- ‚úÖ Old UI v·∫´n ho·∫°t ƒë·ªông (ch·ªâ kh√¥ng c√≥ ch·ª©c nƒÉng m·ªõi)
- ‚úÖ Old API deprecated nh∆∞ng v·∫´n work (return warning)

### Database indexes:

```javascript
// NhanVienNhiemVu indexes
{ NhanVienID: 1, NhiemVuThuongQuyID: 1, ChuKyDanhGiaID: 1 }  // Unique
{ NhanVienID: 1 }                                             // Query performance
{ ChuKyDanhGiaID: 1 }                                         // Filter by cycle

// Check index usage:
db.nhanviennhiemvus.getIndexes()
db.nhanviennhiemvus.aggregate([
  { $indexStats: {} }
])
```

### Validation rules:

- `ChuKyDanhGiaID`: String (ObjectId) | null
- `MucDoKho`: Integer, 1-10, required
- `assignments`: Array, min length = 1

### Error handling:

- 400: Validation error (ƒë·ªô kh√≥ kh√¥ng h·ª£p l·ªá)
- 403: Permission denied (kh√¥ng c√≥ quy·ªÅn g√°n)
- 404: Not found (chu k·ª≥ kh√¥ng t·ªìn t·∫°i)
- 409: Conflict (duplicate assignment - should not happen v·ªõi unique index)

---

## üéØ SUCCESS CRITERIA

### Backend:

- ‚úÖ T·∫•t c·∫£ APIs tr·∫£ v·ªÅ 200 OK v·ªõi data ƒë√∫ng format
- ‚úÖ Unique constraint ho·∫°t ƒë·ªông (duplicate ‚Üí error)
- ‚úÖ Query performance < 100ms (v·ªõi index)
- ‚úÖ Validation ƒë√∫ng (400 v·ªõi message r√µ r√†ng)

### Frontend:

- ‚úÖ UI responsive, kh√¥ng lag khi c√≥ nhi·ªÅu nhi·ªám v·ª•
- ‚úÖ Form validation hi·ªÉn th·ªã error r√µ r√†ng
- ‚úÖ Toast notification sau m·ªói action
- ‚úÖ Reload data t·ª± ƒë·ªông sau success

### E2E:

- ‚úÖ G√°n ‚Üí Ch·∫•m ‚Üí Duy·ªát ‚Üí ƒêi·ªÉm t√≠nh ƒë√∫ng
- ‚úÖ Copy chu k·ª≥ ‚Üí Nhi·ªám v·ª• + ƒë·ªô kh√≥ gi·ªØ nguy√™n
- ‚úÖ Filter theo chu k·ª≥ ‚Üí Hi·ªÉn th·ªã ƒë√∫ng

---

## üîó RELATED DOCUMENTS

- API Documentation: `/docs/API_WORKMANAGEMENT.md`
- Database Schema: `/docs/DATABASE_SCHEMA.md`
- User Guide: `/docs/USER_GUIDE_KPI.md`
- Changelog: `/CHANGELOG.md`

---

**Status:** üìù Planning Phase  
**Next Step:** Review & Approve ‚Üí Start Phase 1  
**Estimated Total Time:** 15-16 hours  
**Target Completion:** Day 4
